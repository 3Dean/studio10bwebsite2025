---
import MainLayout from '../../layouts/MainLayout.astro';
import Button from '../../components/Button.astro';
import ProjectMediaSection from '../../components/ProjectMediaSection.astro';

// Define type for project data
type Project = {
  title: string;
  category: string;
  client: string;
  year: string;
  description: string;
  challenge: string;
  solution: string;
  features: string[];
  mainImage: string;
  galleryImages: string[];
  projectUrl?: string;

  // Simplified video properties
  video?: {
    url: string;
    thumbnail?: string;
    title?: string;
    description?: string;
    isExternal?: boolean;
  };
  embeddedVideo?: {
    provider: 'youtube' | 'vimeo';
    videoId: string;
    title?: string;
    description?: string;
  };
};

// Type-safe project data mapping
const projectData: Record<string, Project> = {
  'marketing-environment': {
    title: "Virtual Marketing Experience",
    category: "Marketing Environment",
    client: "ADAM 4 Artists",
    year: "2023",
    projectUrl: "https://nearhub.club/kGRfWy6/adam-4-artists",
    description: "Our client, a distinguished player in the music business, sought to create an innovative 3D space. The goal was to provide a unique platform that facilitates meaningful connections between musicians and promoters.",
    challenge: "Our task was to develop an immersive, walkable 3D environment designed to educate and engage guests. This interactive space features promotional materials such as PDFs, videos, and images, providing an informative yet captivating experience.",
    solution: "The process began with detailed sketches, moving to creation post-approval. Utilizing Blender, I meticulously crafted the 3D scene, integrating elements that reflect the client's vision. I implemented flexible areas where the site owner can conveniently update videos, PDFs, and images, ensuring the content remains fresh and relevant.",
    features: [
      "Promotional materials such as PDFs, videos, and images",
      "Interactive tour with audio commentary",
      "Social viewing mode for shared experiences"
    ],
    mainImage: "/images/env-project-1.jpg",
    galleryImages: [
      "/images/env-project-1-gallery-1.jpg",
      "/images/env-project-1-gallery-2.jpg",
      "/images/env-project-1-gallery-3.jpg"
    ],
    video: {
      url: "https://deanyeager.s3.us-east-1.amazonaws.com/mozillahubs/adam4artists.mp4",
      thumbnail: "/images/env-project-1-thumbnail.jpg",
      title: "Marketing Experience Walkthrough",
      description: "Take a tour through our virtual marketing experience"
    }
  },
  'videogame-gallery': {
    title: "Independant Game Developers",
    category: "Gallery",
    client: "Human Guild",
    year: "2023",
    projectUrl: "https://nearhub.club/hLyuPmW/",
    description: "Our goal was to raise awareness and engagement for independent developers striving to shine on social media. This project involved creating a virtual gallery that showcases their games in an immersive 3D environment.",
    challenge: "The challenge was to design a virtual space that not only highlights the unique aspects of each game but also provides an engaging and interactive experience for visitors.",
    solution: "We designed a virtual gallery that allows users to explore different game environments, interact with game elements, and learn about the developers' stories. The gallery features interactive displays, video trailers, and links to the games' social media pages.",
    features: [
      "Immersive 3D game environments",
      "Interactive game displays",
      "Developer stories and links to social media"
    ],
    mainImage: "/images/env-project-2.jpg",
    galleryImages: [
      "/images/env-project-2-gallery-1.jpg",
      "/images/env-project-2-gallery-2.jpg",
      "/images/env-project-2-gallery-3.jpg"
    ],
    video: {
      url: "https://deanyeager.s3.us-east-1.amazonaws.com/mozillahubs/vids/Arcade.mp4",
      thumbnail: "/images/env-project-2-thumbnail.jpg",
      title: "Game Gallery Tour",
      description: "Explore the virtual gallery showcasing independent game developers"
    }
  },
  'beach-party-environment': {
    title: "Virtual Party Experience",
    category: "Event",
    client: "Marma J Foundation",
    year: "2023",
    projectUrl: "https://nearhub.club/WV2Ty4a/marma-j-beach-2023",
    description: "A virtual party platform that allows users to host and attend events in a fully interactive 3D environment, complete with music, games, and social features.",
    challenge: "Creating a dynamic and engaging virtual party experience that captures the excitement of real-life events while being accessible to a wide audience.",
    solution: "We developed a customizable virtual space where users can create themed parties, invite friends, and enjoy interactive games and music. The platform supports real-time interactions and social features to enhance the party atmosphere.",
    features: [
      "Customizable virtual party spaces",
      "Real-time music and game integration",
      "Social features for inviting friends",
      "Interactive party games and activities"
    ],
    mainImage: "/images/env-project-3.jpg",
    galleryImages: [
      "/images/env-project-3-gallery-1.jpg",
      "/images/env-project-3-gallery-2.jpg",
      "/images/env-project-3-gallery-3.jpg"
    ],
    video: {
      url: "https://deanyeager.s3.us-east-1.amazonaws.com/mozillahubs/vids/MarmaJ.mp4",
      thumbnail: "/images/env-project-3-thumbnail.jpg",
      title: "Virtual Party Experience Demo",
      description: "Watch our virtual party platform in action"
    }
  },
  'film-festival': {
    title: "Independant Film Festival",
    category: "Event",
    client: "Animaze Montreal",
    year: "2023",
    description: "An immersive 3D environment designed to host a virtual film festival, allowing filmmakers to showcase their work and engage with audiences in a unique way.",
    challenge: "The challenge was to create a virtual space that not only showcases films but also provides an engaging and interactive experience for attendees, including Q&A sessions with filmmakers.",
    solution: "We designed a virtual cinema that allows users to watch films, participate in live Q&A sessions, and explore interactive exhibits related to the films. The environment features multiple screening rooms, interactive displays, and social areas for networking.",
    features: [
      "Multiple screening rooms for different films",
      "Live Q&A sessions with filmmakers",
      "Interactive exhibits related to the films",
      "Social areas for networking and discussions"
    ],
    mainImage: "/images/project-4.jpg",
    galleryImages: [
      "/images/project-4-gallery-1.jpg",
      "/images/project-4-gallery-2.jpg",
      "/images/project-4-gallery-3.jpg"
    ],
    video: {
      url: "https://deanyeager.s3.amazonaws.com/mozillahubs/vids/Theater.mp4",
      thumbnail: "/images/env-project-4-thumbnail.jpg",
      title: "Film Festival Experience",
      description: "Experience the virtual film festival environment designed for Animaze Montreal"
    }
  },
  'fashion-show': {
    title: "LaSalle Signature 24 Fashion Show",
    category: "Fashion",
    client: "LaSalle College of Montreal",
    year: "2024",
    description: "A virtual fashion show environment that allows users to experience the latest collections from LaSalle College's fashion design students in an immersive 3D setting.",
    challenge: "Creating a visually stunning and interactive environment that showcases the fashion designs while providing an engaging user experience.",
    solution: "We designed a virtual runway that highlights the fashion pieces with dynamic lighting, camera angles, and interactive elements that allow users to explore the designs up close.",
    features: [
      "360-degree views of fashion pieces",
      "Designer interviews and behind-the-scenes content",
      "Social sharing features for user-generated content"
    ],
    mainImage: "/images/project-5.jpg",
    galleryImages: [
      "/images/project-5-gallery-1.jpg",
      "/images/project-5-gallery-2.jpg",
      "/images/project-5-gallery-3.jpg"
    ],
    video: {
      url: "https://deanyeager.s3.us-east-1.amazonaws.com/mozillahubs/vids/LaSalleFashionShow.mp4",
      thumbnail: "/images/env-project-5-thumbnail.jpg",
      title: "Fashion Show Experience",
      description: "Watch the LaSalle College fashion show in our immersive virtual environment"
    }
  },
  'industrial-training': {
    title: "Industrial Training Environment",
    category: "Training",
    client: "Global Manufacturing Corp",
    year: "2024",
    description: "A comprehensive virtual training environment for industrial workers to practice complex and potentially hazardous procedures in a safe setting.",
    challenge: "Creating realistic simulations of industrial equipment and processes with accurate physics and safety protocols.",
    solution: "We developed high-fidelity equipment models with functional controls and realistic failure scenarios, integrated with haptic feedback systems for skill development.",
    features: [
      "High-fidelity machine modeling",
      "Procedural safety protocol training",
      "Maintenance and troubleshooting scenarios",
      "Performance tracking and certification"
    ],
    mainImage: "/images/project-6.jpg",
    galleryImages: [
      "/images/project-6.jpg",
      "/images/project-6.jpg",
      "/images/project-6.jpg"
    ],
    embeddedVideo: {
      provider: "youtube",
      videoId: "dQw4w9WgXcQ",
      title: "Industrial Training Demo",
      description: "See our industrial training environment in action"
    }
  }
};

// Get all valid slugs
const validSlugs = Object.keys(projectData);

// Simple getStaticPaths function that returns routes for all projects
export function getStaticPaths() {
  return validSlugs.map(slug => ({
    params: { slug },
    props: { slug }
  }));
}

// Get slug parameter and handle the case when it might not exist
const { slug } = Astro.params;
const currentSlug = typeof slug === 'string' ? slug : '';

// Safer project lookup with fallback
const project = validSlugs.includes(currentSlug) 
  ? projectData[currentSlug] 
  : {
      title: "Project Not Found",
      category: "Error",
      client: "N/A",
      year: "N/A",
      description: "This project could not be found.",
      challenge: "N/A",
      solution: "N/A",
      features: ["N/A"],
      mainImage: "/images/env-project-1.jpg",
      galleryImages: []
    };

// Determine if we have a video to display and what type
const hasLocalVideo = !!project.video;
const hasEmbeddedVideo = !!project.embeddedVideo;
---

<MainLayout title={`${project.title} - Studio 10b`}>
  <!-- Hero Section -->
  <section class="relative h-[70vh] min-h-[600px] flex items-end text-white">
    <div class="absolute inset-0 -z-10">
      <img 
        src={project.mainImage} 
        alt={project.title} 
        class="w-full h-full object-cover"
      />
    </div>
    <div class="absolute inset-0 bg-gradient-to-t from-black/30 to-black/0 -z-10"></div>
    
    <div class="container mx-auto px-4 md:px-8 max-w-screen-xl pb-16">
      <div>
        <h1 class="text-4xl md:text-5xl font-bold mb-4">{project.title}</h1>
        <p class="text-xl opacity-80">{project.category}</p>
      </div>
    </div>
  </section>
  
  <!-- Project Details Section -->
  <section class="py-24">
    <div class="container mx-auto px-4 md:px-8 max-w-screen-xl">
      <div class="grid lg:grid-cols-3 gap-16">
        <!-- Main Content (2/3 width) -->
        <div class="lg:col-span-2 space-y-16">
          <!-- Overview -->
          <div>
            <h2 class="text-3xl md:text-4xl font-bold mb-6">Overview</h2>
            <p class="text-lg leading-relaxed">{project.description}</p>
          </div>
          
          <!-- Video Media Section - Local video takes precedence if both exist -->
          {hasLocalVideo && (
            <ProjectMediaSection 
              video={project.video} 
              isEmbedded={false}
            />
          )}
          
          {!hasLocalVideo && hasEmbeddedVideo && (
            <ProjectMediaSection 
              video={project.embeddedVideo}
              isEmbedded={true}
            />
          )}
          
          <!-- Challenge & Solution -->
          <div class="grid md:grid-cols-2 gap-8 bg-gray-50 p-8 rounded-lg">
            <div>
              <h3 class="text-2xl font-bold mb-4">The Challenge</h3>
              <p class="leading-relaxed">{project.challenge}</p>
            </div>
            <div>
              <h3 class="text-2xl font-bold mb-4">Our Solution</h3>
              <p class="leading-relaxed">{project.solution}</p>
            </div>
          </div>
          
          <!-- Key Features -->
          <div>
            <h3 class="text-2xl font-bold mb-6">Key Features</h3>
            <ul class="space-y-4">
              {project.features.map((feature: string) => (
                <li class="relative pl-8 text-lg">
                  <span class="absolute left-0 top-0 text-black">→</span>
                  {feature}
                </li>
              ))}
            </ul>
          </div>
          
          <!-- Project Gallery -->
          {project.galleryImages && project.galleryImages.length > 0 && (
            <div>
              <h3 class="text-2xl font-bold mb-6">Project Gallery</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {project.galleryImages.map((image: string) => (
                  <div class="rounded-lg overflow-hidden h-48 md:h-52">
                    <img 
                      src={image} 
                      alt={`${project.title} gallery image`} 
                      class="w-full h-full object-cover transition-transform duration-500 hover:scale-105"
                    />
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
        
        <!-- Sidebar (1/3 width) -->
        <div>
          <div class="bg-gray-50 p-6 md:p-8 rounded-lg sticky top-8">
            <h3 class="text-2xl font-bold mb-6">Project Information</h3>
            
            <div class="flex justify-between py-4 border-b border-gray-200">
              <span class="font-semibold">Client</span>
              <span>{project.client}</span>
            </div>
            
            <div class="flex justify-between py-4 border-b border-gray-200">
              <span class="font-semibold">Category</span>
              <span>{project.category}</span>
            </div>
            
            <div class="flex justify-between py-4 border-b border-gray-200">
              <span class="font-semibold">Year</span>
              <span>{project.year}</span>
            </div>
            
            <div class="mt-8 flex flex-col gap-4">
              {project.projectUrl ? (
                <Button href={project.projectUrl} variant="outline" openInNewTab={true}>
                  View Project
                </Button>
              ) : (
                <Button href="/contact" variant="outline">
                  Request Demo
                </Button>
              )}
              <Button href="/contact" variant="primary">
                Inquire About This Project
              </Button>
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Related Projects Section -->
  <section class="py-24 bg-gray-50">
    <div class="container mx-auto px-4 md:px-8 max-w-screen-xl">
      <h2 class="text-3xl md:text-4xl font-bold mb-12 text-center">Related Projects</h2>
      
      <div class="grid md:grid-cols-2 gap-10">
        <div class="bg-white rounded-lg overflow-hidden shadow-lg transition-transform duration-300 hover:-translate-y-2">
          <a href="/projects/urban-planning" class="block text-current no-underline">
            <div class="h-60 overflow-hidden">
              <img 
                src="/images/project-4.jpg" 
                alt="Urban Planning Simulator" 
                class="w-full h-full object-cover transition-transform duration-500 hover:scale-105"
              />
            </div>
            <div class="p-6">
              <h3 class="text-xl font-medium mb-2">Urban Planning Simulator</h3>
              <span class="text-sm text-gray-600">Simulation</span>
            </div>
          </a>
        </div>
        
        <div class="bg-white rounded-lg overflow-hidden shadow-lg transition-transform duration-300 hover:-translate-y-2">
          <a href="/projects/wildlife-conservation" class="block text-current no-underline">
            <div class="h-60 overflow-hidden">
              <img 
                src="/images/project-5.jpg" 
                alt="Wildlife Conservation Experience" 
                class="w-full h-full object-cover transition-transform duration-500 hover:scale-105"
              />
            </div>
            <div class="p-6">
              <h3 class="text-xl font-medium mb-2">Wildlife Conservation Experience</h3>
              <span class="text-sm text-gray-600">Education</span>
            </div>
          </a>
        </div>
      </div>
    </div>
  </section>
</MainLayout>